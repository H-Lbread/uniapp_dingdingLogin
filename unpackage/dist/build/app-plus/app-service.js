if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const n=this.constructor;return this.then((o=>n.resolve(e()).then((()=>o))),(o=>n.resolve(e()).then((()=>{throw o}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function n(e,n,...o){uni.__log__?uni.__log__(e,n,...o):console[e].apply(console,[...o,n])}const o=["/pages/Login/index"];function t(){return uni.getStorageSync("token")}function i(e){uni.setStorageSync("token",e)}const a=(e,n)=>{const o=e.__vccOpts||e;for(const[t,i]of n)o[t]=i;return o};const r=a({data(){var e;const n=(null==(e=null==window?void 0:window.location)?void 0:e.href)||"",o=n.includes("localhost")||n.includes("127.0.0.1");return{username:"",password:"",rememberPwd:!1,dingConfig:{appId:"ef1adba3-8bd1-40a1-8162-1ed1d8da9251",redirectUri:encodeURIComponent(o?"http://localhost:5173/pages/Login/index":"https://your-domain.com/pages/Login/index")}}},onLoad(e){t()&&uni.reLaunch({url:"/pages/Home/index"})},methods:{handleLogin(){this.username&&this.password?(uni.showLoading({title:"登录中..."}),uni.request({url:"your_api_url/login",method:"POST",data:{username:this.username,password:this.password},success:e=>{0===e.data.code?(i(e.data.data.token),uni.setStorageSync("userInfo",e.data.data.userInfo),uni.reLaunch({url:"/pages/Home/index"})):uni.showToast({title:e.data.msg||"登录失败",icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{uni.hideLoading()}})):uni.showToast({title:"请输入账号和密码",icon:"none"})},handleDingDingLogin(){this.dingdingAppLogin()},dingdingH5Login(){n("log","at pages/Login/index.vue:134","钉钉登录URL:",`https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=${this.dingConfig.appId}&response_type=code&scope=snsapi_auth&state=STATE&redirect_uri=${this.dingConfig.redirectUri}`)},dingdingAppLogin(){try{const n=(e="DingTalk-Login",weex.requireModule(e));if(!n)throw new Error("钉钉登录插件未找到");n.login((e=>{0===e.code?this.dingLoginToServer(e.data):uni.showToast({title:e.message||"登录失败",icon:"none",duration:3e3})}))}catch(o){n("error","at pages/Login/index.vue:165","钉钉登录错误：",o),uni.showToast({title:o.message||"登录失败",icon:"none",duration:3e3})}var e},dingLoginToServer(e){n("log","at pages/Login/index.vue:180","登录成功",e),uni.showLoading({title:"登录中..."}),uni.request({url:"your_api_url/dingding/login",method:"POST",data:{authCode:e},success:e=>{0===e.data.code?(i(e.data.data.token),uni.setStorageSync("userInfo",e.data.data.userInfo),uni.reLaunch({url:"/pages/Home/index"})):uni.showToast({title:e.data.msg||"登录失败",icon:"none"})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{uni.hideLoading()}})},handleRememberPwdChange(e){this.rememberPwd=e.detail.value}}},[["render",function(n,o,t,i,a,r){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("image",{class:"logo",src:"/static/login/logo.png"}),e.createElementVNode("view",{class:"login-form"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("image",{class:"icon",src:"/static/login/user.png"}),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>a.username=e),placeholder:"请输入账号"},null,512),[[e.vModelText,a.username]])]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("image",{class:"icon",src:"/static/login/password.png"}),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":o[1]||(o[1]=e=>a.password=e),placeholder:"请输入密码"},null,512),[[e.vModelText,a.password]])]),e.createElementVNode("view",{class:"remember-pwd"},[e.createElementVNode("checkbox",{checked:a.rememberPwd,onChange:o[2]||(o[2]=(...e)=>r.handleRememberPwdChange&&r.handleRememberPwdChange(...e)),color:"#ff6a00"},null,40,["checked"]),e.createElementVNode("text",null,"记住密码")]),e.createElementVNode("button",{class:"login-btn",onClick:o[3]||(o[3]=(...e)=>r.handleLogin&&r.handleLogin(...e))},"登录"),e.createElementVNode("view",{class:"other-login"},[e.createElementVNode("text",null,"其他方式登录"),e.createElementVNode("view",{class:"other-icons"},[e.createElementVNode("image",{class:"other-icon",src:"/static/login/dingding.png",onClick:o[4]||(o[4]=(...e)=>r.handleDingDingLogin&&r.handleDingDingLogin(...e))})])])])])}]]);const s=a({mixins:[{onLoad(){const e=getCurrentPages();(function(e){return-1!==o.indexOf(e)||!!t()})(`/${e[e.length-1].route}`)||uni.redirectTo({url:"/pages/Login/index"})}}],data:()=>({}),methods:{handleLogout(){uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.reLaunch({url:"/pages/Login/index"})}}},[["render",function(n,o,t,i,a,r){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("text",null,"首页"),e.createElementVNode("button",{onClick:o[0]||(o[0]=(...e)=>r.handleLogout&&r.handleLogout(...e))},"退出登录")])}]]);__definePage("pages/Login/index",r),__definePage("pages/Home/index",s);const l={onLaunch:function(){n("log","at App.vue:6","App Launch")},onShow:function(){n("log","at App.vue:9","App Show")},onHide:function(){n("log","at App.vue:12","App Hide")},onPageNotFound(e){uni.redirectTo({url:"/pages/Login/index"})}};const{app:d,Vuex:c,Pinia:u}={app:e.createVueApp(l)};uni.Vuex=c,uni.Pinia=u,d.provide("__globalStyles",__uniConfig.styles),d._component.mpType="app",d._component.render=()=>{},d.mount("#app")}(Vue);
